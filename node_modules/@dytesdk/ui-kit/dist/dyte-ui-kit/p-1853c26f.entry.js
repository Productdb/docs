import{r as t,w as s,h as i,H as e,a}from"./p-f3ae5269.js";import{u as r}from"./p-02da5bca.js";import{s as n}from"./p-e0d02dd9.js";import"./p-0229e3de.js";import{d as o}from"./p-c8c07ee9.js";import"./p-f5545e11.js";import"./p-57e22a58.js";import{c as h}from"./p-264cff16.js";import"./p-ffc8ef45.js";import"./p-5d856930.js";import"./p-c2c75ac6.js";import"./p-2c39bb8e.js";import"./p-63092db3.js";const p=class{constructor(s){t(this,s),this.onTranscript=t=>{t.transcript&&this.add(t)},this.meeting=void 0,this.states=n,this.config=o,this.t=r(),this.transcripts=[],this.listenerAttached=!1}connectedCallback(){this.meetingChanged(this.meeting)}addListener(t){var s;null===(s=null==t?void 0:t.ai)||void 0===s||s.addListener("transcript",this.onTranscript),this.listenerAttached=!0}clearListeners(t){var s;this.onTranscript&&(null===(s=null==t?void 0:t.ai)||void 0===s||s.removeListener("transcript",this.onTranscript)),this.listenerAttached=!1,clearTimeout(this.disconnectTimeout),this.transcripts=[]}disconnectedCallback(){null!=this.meeting&&this.clearListeners(this.meeting)}meetingChanged(t,s){clearTimeout(this.disconnectTimeout),void 0!==s&&this.clearListeners(s),null!=t&&this.states.activeCaptions&&this.addListener(t)}statesChanged(t){const s=t||n;s.activeCaptions&&!this.listenerAttached&&this.addListener(this.meeting),!s.activeCaptions&&this.listenerAttached&&this.clearListeners(this.meeting)}transcriptionsReducer(t,s){if(!t.length)return[s];let i=t[t.length-1];return i.peerId!==s.peerId||i.transcript.length+s.transcript.length>400?t.concat(s):(i.transcript+=" "+s.transcript,t.pop(),t.concat(h(i)))}add(t){this.transcripts.splice(0,this.transcripts.length-2),this.transcripts=this.transcriptionsReducer(this.transcripts,t)}remove(t){this.transcripts=this.transcripts.filter((s=>s.id!==t))}handleDismiss(t){t.stopPropagation();const i=t.detail,e=this.host.shadowRoot.querySelector(`[data-id="${i}"]`);null==e||e.classList.add("exit"),setTimeout((()=>{s((()=>{this.remove(i)}))}),400)}render(){var t;if(this.states.activeCaptions)return i(e,null,null===(t=this.transcripts)||void 0===t?void 0:t.map((t=>i("dyte-transcript",{key:t.id,"data-id":t.id,transcript:t,onDyteTranscriptDismiss:t=>this.handleDismiss(t),t:this.t}))))}get host(){return a(this)}static get watchers(){return{meeting:["meetingChanged"],states:["statesChanged"]}}};p.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{position:absolute;top:var(--dyte-space-4, 16px);right:var(--dyte-space-4, 16px);bottom:var(--dyte-space-4, 16px);left:var(--dyte-space-4, 16px);top:auto;display:flex;flex-direction:column;pointer-events:none;justify-content:center;width:100%;z-index:5}dyte-transcript{margin-top:var(--dyte-space-2, 8px)}";export{p as dyte_transcripts}