import{r as t,c as e,h as i,H as n,a as s,w as a}from"./p-f3ae5269.js";import{s as o}from"./p-e0d02dd9.js";import"./p-0229e3de.js";import{s as r}from"./p-f5545e11.js";import{d}from"./p-cadf534b.js";import{u as c}from"./p-02da5bca.js";import{a as l,c as h}from"./p-57e22a58.js";import{d as p}from"./p-36ba48a7.js";import{M as g,j as u}from"./p-d0b39589.js";import{d as v,f as y,e as b}from"./p-7fbac17c.js";import{s as m}from"./p-8ac388c5.js";import{d as f}from"./p-c8c07ee9.js";import{R as x}from"./p-0dd43c7b.js";import{R as w}from"./p-9e417fb4.js";import{D as k}from"./p-9ec5cbce.js";import{f as C}from"./p-4de316e3.js";import"./p-ffc8ef45.js";import"./p-5d856930.js";import"./p-63092db3.js";import"./p-e1ac2003.js";const j=class{constructor(i){t(this,i),this.search=e(this,"search",7),this.searchDismissed=e(this,"searchDismissed",7),this.back=e(this,"back",7),this.meeting=void 0,this.channel=void 0,this.iconPack=d,this.t=c(),this.showChannelDetailsDialog=!1,this.showSearchBar=!1,this.members=[],this.showBackButton=!1}onChannelChanged(){this.$searchInput&&(this.$searchInput.value=""),this.showSearchBar=!1,this.channel.isDirectMessage||this.meeting.chat.getChannelMembers(this.channel.id).then((t=>{this.members=t}))}connectedCallback(){this.onChannelChanged()}renderChannelDetails(){return i("dyte-dialog",{open:!0,onDyteDialogClose:()=>{this.showChannelDetailsDialog=!1},iconPack:this.iconPack,t:this.t},i("dyte-channel-details",{members:this.members,channel:this.channel}))}render(){return this.channel?i(n,null,this.showChannelDetailsDialog&&this.renderChannelDetails(),i("header",{class:{searching:this.showSearchBar}},this.showBackButton&&i("dyte-button",{kind:"icon",variant:"secondary",class:"back-btn",onClick:()=>{this.back.emit()}},i("dyte-icon",{icon:this.iconPack.chevron_left})),i("div",{class:"channel-details"},i("span",{class:"name"},this.channel.displayName),!this.channel.isDirectMessage&&i("span",{class:"members"},this.members.map((t=>t.name)).join(", "))),i("div",{class:"channel-tools"},!this.channel.isDirectMessage&&i("dyte-tooltip",{label:this.t("chat.channel_members"),iconPack:this.iconPack,t:this.t,variant:"primary"},i("dyte-button",{iconPack:this.iconPack,t:this.t,kind:"button",variant:"secondary",size:"md",onClick:()=>{this.showChannelDetailsDialog=!this.showChannelDetailsDialog},class:"br-primary-btn"},i("dyte-icon",{icon:this.iconPack.people,iconPack:this.iconPack,t:this.t})))))):null}static get watchers(){return{channel:["onChannelChanged"]}}};j.style="header{box-sizing:border-box;height:var(--dyte-space-16, 64px);width:100%;padding:var(--dyte-space-4, 16px);display:flex;justify-content:space-between;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity));border-left-width:var(--dyte-border-width-none, 0);border-right-width:var(--dyte-border-width-none, 0);border-bottom-width:var(--dyte-border-width-sm, 1px);border-top-width:var(--dyte-border-width-none, 0);border-style:solid;--tw-border-opacity:1;border-bottom-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-border-opacity))}header.searching{justify-content:flex-end}header.searching .channel-details{display:none}header .channel-details{display:flex;flex-grow:1;flex-direction:column;justify-content:center;height:var(--dyte-space-9, 36px);width:var(--dyte-space-1, 4px)}header .channel-details .name{font-weight:500}header .channel-details .members{margin-top:var(--dyte-space-0\\.5, 2px);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:12px;color:rgb(var(--dyte-colors-text-600, 255 255 255 / 0.52))}header .channel-tools{display:flex;flex-shrink:0;justify-content:flex-end;gap:var(--dyte-space-1, 4px);min-width:var(--dyte-space-24, 96px)}header .channel-tools dyte-tooltip{height:var(--dyte-space-8, 32px);width:var(--dyte-space-10, 40px);display:flex}header .search-input{height:var(--dyte-space-8, 32px);width:var(--dyte-space-48, 192px);padding-left:var(--dyte-space-2, 8px);padding-right:var(--dyte-space-2, 8px);border-width:var(--dyte-border-width-none, 0);border-style:none;outline:2px solid transparent;outline-offset:2px;border-radius:var(--dyte-border-radius-sm, 4px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));color:rgb(var(--dyte-colors-text-1000, 255 255 255))}header .name{font-size:16px}header .br-primary-btn{background-color:transparent}header .br-primary-btn:hover{--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity))}@media (orientation: landscape) and (min-width: 400px){header.searching .channel-details{display:flex}}.back-btn{margin-right:var(--dyte-space-3, 12px)}";const _=class{constructor(i){t(this,i),this.channelChange=e(this,"channelChange",7),this.calculateListHeight=p((()=>{if("list"===this.viewAs&&this.$listEl){let t=0;const e=this.$el.shadowRoot.querySelector('slot[name="header"]');e&&e.assignedElements().forEach((e=>t+=e.offsetHeight)),this.$searchEl&&(t+=this.$searchEl.offsetHeight),this.$listEl.style.height=window.innerHeight-t-16+"px"}}),60),this.getFilteredChannels=()=>""===this.searchQuery.trim()?this.channels:this.channels.filter((t=>t.name.toLowerCase().includes(this.searchQuery.toLowerCase()))),this.toggleDropdown=()=>{this.showDropdown=!this.showDropdown},this.getChannelById=t=>this.channels.find((e=>e.id===t)),this.getTotalUnreads=()=>this.channels.reduce(((t,e)=>t+e.unreadCount),0),this.onChannelClickHandler=t=>{this.channelChange.emit(t),"dropdown"===this.viewAs&&(this.showDropdown=!1)},this.channels=void 0,this.selectedChannelId=void 0,this.disableSearch=!1,this.hideAvatar=!1,this.iconPack=d,this.t=c(),this.viewAs="list",this.searchQuery="",this.showDropdown=!1}connectedCallback(){this.resizeObserver=new ResizeObserver(this.calculateListHeight)}componentDidLoad(){this.resizeObserver.observe(this.$el),this.calculateListHeight()}disconnectedCallback(){var t;null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.calculateListHeight.cancel()}getTimeLabel(t){const e=new Date,i=new Date(e);i.setDate(e.getDate()-1);const n=new Date(e);return n.setDate(e.getDate()-e.getDay()-1),t.toDateString()===e.toDateString()?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toDateString()===i.toDateString()?this.t("date.yesteday"):t>n?this.t(["date.sunday","date.monday","date.tuesday","date.wednesday","date.thursday","date.friday","date.saturday"][t.getDay()]):Intl.DateTimeFormat([],{day:"2-digit",month:"2-digit",year:"2-digit"}).format(t)}render(){const t=this.getFilteredChannels(),e="list"===this.viewAs||"dropdown"===this.viewAs&&this.showDropdown;return i(n,null,"list"===this.viewAs&&i("slot",{name:"header"}),e&&i("div",{class:{dropdown:"dropdown"===this.viewAs,scrollbar:"dropdown"===this.viewAs,list:"list"===this.viewAs}},!this.disableSearch&&i("div",{class:"search-container",ref:t=>this.$searchEl=t},i("input",{type:"text",placeholder:this.t("chat.search_conversations"),value:this.searchQuery,onInput:t=>this.searchQuery=t.target.value}),i("dyte-icon",{icon:this.iconPack.search})),i("div",{class:"channels-container scrollbar",ref:t=>this.$listEl=t},t.map((t=>i("button",{class:{channel:!0,active:this.selectedChannelId===t.id},onClick:()=>this.onChannelClickHandler(t)},!this.hideAvatar&&i("div",null,t.icon?i("dyte-icon",{class:"avatar-icon",icon:this.iconPack[t.icon]}):i("dyte-avatar",{participant:{name:t.name,picture:t.avatarUrl}})),i("div",{class:"channel-data"},i("div",{class:"col"},i("div",{class:"name"},t.name),t.latestMessage&&i("div",{class:{"last-message":!0,"no-message":!t.latestMessage}},i("dyte-text-message-view",{isMarkdown:!0,text:t.latestMessage}))),i("div",{class:"col channel-meta"},t.latestMessageTime&&i("time",{class:"time"},this.getTimeLabel(t.latestMessageTime)),t.unreadCount>0&&i("div",{class:"unread-count"},t.unreadCount)))))))),"dropdown"===this.viewAs&&i("button",{class:"dropdown-trigger",onClick:this.toggleDropdown},i("span",null,this.selectedChannelId&&`${this.t("to")} ${this.getChannelById(this.selectedChannelId).name}`,this.getTotalUnreads()>0&&i("div",{class:"unread-count"},this.getTotalUnreads())),i("dyte-icon",{icon:this.showDropdown?this.iconPack.chevron_up:this.iconPack.chevron_down})))}get $el(){return s(this)}};_.style=".scrollbar {\n  /* For Firefox */\n  scrollbar-width: thin;\n  scrollbar-color: var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)))\n    var(--dyte-scrollbar-background, transparent);\n}\n\n/* For WebKit */\n.scrollbar::-webkit-scrollbar {\n  height: var(--dyte-space-1\\.5, 6px);\n  width: var(--dyte-space-1\\.5, 6px);\n  border-radius: 9999px;\n  background-color: var(--dyte-scrollbar-background, transparent);\n}\n\n.scrollbar::-webkit-scrollbar-thumb {\n  border-radius: 9999px;\n  background-color: var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)));\n}\n\n\n:host {\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));\n  position: relative;\n  z-index: 10;\n  height: var(--dyte-space-12, 48px);\n  min-height: 48px;\n}\n\n.dropdown-trigger {\n  height: 100%;\n  width: 100%;\n  border-width: var(--dyte-border-width-none, 0);\n  border-style: none;\n  padding: var(--dyte-space-4, 16px);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-700, 44 44 44) / var(--tw-bg-opacity));\n  font-size: 14px;\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n  cursor: pointer;\n  position: absolute;\n  z-index: 20;\n}\n\n.dropdown-trigger span {\n  display: flex;\n  flex: 1 1 0%;\n  align-items: center;\n  justify-content: space-between;\n}\n\n.dropdown-trigger dyte-icon {\n  margin-left: var(--dyte-space-1, 4px);\n  height: var(--dyte-space-5, 20px);\n  width: var(--dyte-space-5, 20px);\n  flex-shrink: 0;\n}\n\n@container chatcontainer (height < 360px) {\n  .dropdown-trigger {\n    padding: var(--dyte-space-2, 8px);\n  }\n  .dropdown {\n    top: var(--dyte-space-8, 32px) !important;\n  }\n  .search-container {\n    padding-left: var(--dyte-space-0, 0px) !important;\n    padding-right: var(--dyte-space-0, 0px) !important;\n    padding-top: var(--dyte-space-0, 0px) !important;\n    padding-bottom: var(--dyte-space-0, 0px) !important;\n  }\n  input {\n    height: var(--dyte-space-8, 32px) !important;\n    border-radius: var(--dyte-border-radius-none, 0) !important;\n  }\n  .channel {\n    height: var(--dyte-space-8, 32px) !important;\n    border-radius: var(--dyte-border-radius-sm, 4px) !important;\n  }\n  .avatar-icon {\n    height: var(--dyte-space-3, 12px) !important;\n    width: var(--dyte-space-3, 12px) !important;\n    padding: var(--dyte-space-1, 4px) !important;\n  }\n\n  dyte-avatar {\n    height: var(--dyte-space-5, 20px) !important;\n    width: var(--dyte-space-5, 20px) !important;\n  }\n}\n\n.dropdown {\n  position: absolute;\n  width: 100%;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));\n  top: var(--dyte-space-12, 48px);\n  z-index: 10;\n  animation: 0.3s slide-down ease;\n}\n\n.dropdown .channels-container {\n  max-height: var(--dyte-space-80, 320px);\n}\n\n.list {\n  display: flex;\n  flex-direction: column;\n}\n\n.list .channel .channel-data {\n  align-items: flex-start;\n}\n\n.unread-count {\n  display: flex;\n  justify-content: center;\n  height: var(--dyte-space-5, 20px);\n  min-width: var(--dyte-space-3, 12px);\n  border-radius: 9999px;\n  padding-left: var(--dyte-space-1, 4px);\n  padding-right: var(--dyte-space-1, 4px);\n  font-size: 12px;\n  line-height: 1.25rem;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-on-brand-1000, var(--dyte-colors-text-1000, 255 255 255)));\n}\n\ninput {\n  height: var(--dyte-space-9, 36px);\n  width: 100%;\n  padding-left: var(--dyte-space-3, 12px);\n  padding-right: var(--dyte-space-3, 12px);\n  box-sizing: border-box;\n  border-width: var(--dyte-border-width-none, 0);\n  border-style: none;\n  outline: 2px solid transparent;\n  outline-offset: 2px;\n  border-radius: var(--dyte-border-radius-sm, 4px);\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-600, 60 60 60) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n}\n\n.search-container {\n  display: flex;\n  flex-shrink: 0;\n  flex-grow: 0;\n  flex-basis: auto;\n  align-items: center;\n  padding-top: var(--dyte-space-3, 12px);\n  padding-bottom: var(--dyte-space-3, 12px);\n  padding-left: var(--dyte-space-2, 8px);\n  padding-right: var(--dyte-space-2, 8px);\n  border-bottom: var(--dyte-border-width-sm, 1px) solid rgb(var(--dyte-colors-background-700, 44 44 44));\n}\n\n.search-container dyte-icon {\n  margin-left: calc(var(--dyte-space-8, 32px) * -1);\n  height: var(--dyte-space-5, 20px);\n  width: var(--dyte-space-5, 20px);\n  color: rgb(var(--dyte-colors-text-800, 255 255 255 / 0.76));\n}\n\n.channels-container {\n  display: flex;\n  flex-direction: column;\n  gap: var(--dyte-space-1, 4px);\n  padding: var(--dyte-space-2, 8px);\n  flex: 1 1 auto;\n  overflow-y: auto;\n}\n\n.channel {\n  flex-shrink: 0;\n  box-sizing: border-box;\n  border-width: var(--dyte-border-width-none, 0);\n  border-style: none;\n  background-color: transparent;\n  outline: 2px solid transparent;\n  outline-offset: 2px;\n  cursor: pointer;\n  border-radius: var(--dyte-border-radius-md, 8px);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: var(--dyte-space-2, 8px);\n  height: var(--dyte-space-16, 64px);\n  width: 100%;\n  padding-left: var(--dyte-space-2, 8px);\n  padding-right: var(--dyte-space-3, 12px);\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n  transition-property: color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;\n  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;\n  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 150ms;\n}\n\n.channel:hover {\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-600, 60 60 60) / var(--tw-bg-opacity));\n}\n\n.channel .channel-data {\n  flex: 1 1 0%;\n  align-items: center;\n  justify-content: space-between;\n  display: flex;\n  gap: var(--dyte-space-2, 8px);\n}\n\n.channel .name {\n  font-size: 16px;\n}\n\n.channel .name, \n  .channel .last-message {\n  max-width: var(--dyte-space-40, 160px);\n  text-align: left;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 1;\n}\n\n.channel .no-message {\n  font-style: italic;\n}\n\n.channel dyte-avatar {\n  height: var(--dyte-space-12, 48px);\n  width: var(--dyte-space-12, 48px);\n  overflow: clip;\n  border-radius: 9999px;\n  font-size: 14px;\n}\n\n.channel .avatar-icon {\n  height: var(--dyte-space-6, 24px);\n  width: var(--dyte-space-6, 24px);\n  padding: var(--dyte-space-3, 12px);\n  color: rgb(var(--dyte-colors-text-on-brand-1000, var(--dyte-colors-text-1000, 255 255 255)));\n  overflow: clip;\n  border-radius: 9999px;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-bg-opacity));\n}\n\n.channel time, \n  .channel .last-message {\n  font-size: 12px;\n  color: rgb(var(--dyte-colors-text-800, 255 255 255 / 0.76));\n}\n\n.channel.active {\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-brand-300, 73 124 253) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-on-brand-1000, var(--dyte-colors-text-1000, 255 255 255)));\n}\n\n.channel.active .unread-count {\n  background-color: rgb(var(--dyte-colors-text-on-brand-800, var(--dyte-colors-text-800, 255 255 255 / 0.76)));\n  --tw-text-opacity: 1;\n  color: rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-text-opacity));\n}\n\n.channel.active time {\n  color: rgb(var(--dyte-colors-text-on-brand-800, var(--dyte-colors-text-800, 255 255 255 / 0.76)));\n}\n\n.channel.active .last-message {\n  color: rgb(var(--dyte-colors-text-on-brand-700, var(--dyte-colors-text-700, 255 255 255 / 0.64)));\n}\n\n.channel.active dyte-avatar {\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-on-brand-1000, var(--dyte-colors-text-1000, 255 255 255)));\n}\n\n.col {\n  gap: var(--dyte-space-1, 4px);\n  display: flex;\n  flex-direction: column;\n}\n\n.channel-meta {\n  flex-shrink: 0;\n  align-items: flex-end;\n}\n\n@keyframes slide-down {\n  from {\n    transform: translateY(-50px);\n  }\n  to {\n    transform: translateY(0%);\n  }\n}\n";const D=class{constructor(i){t(this,i),this.onNewMessage=e(this,"newMessage",7),this.onEditMessage=e(this,"editMessage",7),this.onEditCancel=e(this,"editCancel",7),this.onQuotedMessageDismiss=e(this,"quotedMessageDismiss",7),this.textMessage="",this.sendFile=()=>{this.canSendFiles&&(this.onNewMessage.emit("image"===this.fileToUpload.type?{type:"image",image:this.fileToUpload.file}:{type:"file",file:this.fileToUpload.file}),this.fileToUpload=null)},this.handleSendMessage=()=>{if(!this.canSendTextMessage)return;if(null!==this.fileToUpload)return void this.sendFile();const t=this.textMessage;t.length>0&&(this.onNewMessage.emit({type:"text",message:t}),this.cleanup())},this.handleEditMessage=()=>{this.onEditMessage.emit(this.textMessage),this.cleanup()},this.handleEditCancel=()=>{this.onEditCancel.emit(),this.cleanup()},this.onTextChangeHandler=t=>{this.textMessage=t.detail,l.setItem(this.storageKey,t.detail)},this.onKeyDownHandler=t=>{"Enter"===t.key&&t.shiftKey||"Enter"===t.key&&(t.preventDefault(),this.isEditing?this.handleEditMessage():this.handleSendMessage())},this.onFileUploadHandler=(t,e)=>{this.fileToUpload={type:t,file:e}},this.onQuotedMessageDismissHandler=()=>{this.onQuotedMessageDismiss.emit()},this.cleanup=()=>{this.textMessage="",this.fileToUpload=null,l.setItem(this.storageKey,""),this.$textComposer.setText("",!0),this.isEmojiPickerOpen=!1},this.canSendTextMessage=!0,this.canSendFiles=!0,this.message="",this.quotedMessage="",this.storageKey="dyte-text-message",this.inputTextPlaceholder="Enter your message",this.isEditing=!1,this.iconPack=d,this.t=c(),this.disableEmojiPicker=!1,this.fileToUpload=null,this.isEmojiPickerOpen=!1}connectedCallback(){this.textMessage=this.message||l.getItem(this.storageKey)||""}componentWillUpdate(){this.textMessage=this.message||l.getItem(this.storageKey)||""}componentDidLoad(){this.message&&a((()=>this.$textComposer.setText(this.message,!0)))}render(){const t={iconPack:this.iconPack,t:this.t};return i(n,null,this.canSendTextMessage&&this.isEmojiPickerOpen&&i("dyte-emoji-picker",Object.assign({part:"emoji-picker",onPickerClose:()=>{this.isEmojiPickerOpen=!1},onDyteEmojiClicked:t=>{this.textMessage+=t.detail,this.$textComposer.setText(this.textMessage,!0)}},t)),i("slot",{name:"chat-addon"}),this.quotedMessage&&0!==this.quotedMessage.length&&i("div",{class:"quoted-message-container",part:"quoted-message-container"},i("div",{class:"quoted-message scrollbar"},i("dyte-text-message-view",{text:this.quotedMessage,isMarkdown:!0})),i("div",null,i("dyte-icon",Object.assign({"aria-label":this.t("dismiss"),class:"dismiss",icon:this.iconPack.dismiss,onClick:this.onQuotedMessageDismissHandler},t)))),i("div",{class:"composer-container"},i("div",{class:"composers"},this.fileToUpload&&i("dyte-draft-attachment-view",{attachment:this.fileToUpload,onDeleteAttachment:()=>this.fileToUpload=null}),!this.fileToUpload&&i("dyte-text-composer-view",{value:this.textMessage,placeholder:this.inputTextPlaceholder,onTextChange:this.onTextChangeHandler,keyDownHandler:this.onKeyDownHandler,maxLength:g,ref:t=>this.$textComposer=t})),i("div",{class:"chat-buttons",part:"chat-buttons"},i("div",{class:"left",part:"chat-buttons-left"},!this.fileToUpload&&!this.isEditing&&i("div",null,this.canSendFiles&&[i("dyte-file-picker-button",{onFileChange:t=>this.onFileUploadHandler("file",t.detail)}),i("dyte-file-picker-button",{filter:"image/*",label:this.t("chat.send_img"),icon:"image",onFileChange:t=>this.onFileUploadHandler("image",t.detail)})],this.canSendTextMessage&&!this.disableEmojiPicker&&i("dyte-emoji-picker-button",{isActive:this.isEmojiPickerOpen,onClick:()=>{this.isEmojiPickerOpen=!this.isEmojiPickerOpen}}),i("slot",{name:"chat-buttons"}))),i("div",{class:"right",part:"chat-buttons-right"},!this.isEditing&&i("dyte-tooltip",Object.assign({variant:"primary",label:this.t("chat.send_msg"),delay:2e3},t),i("dyte-button",Object.assign({kind:"icon",onClick:()=>this.handleSendMessage(),title:this.t("chat.send_msg")},t),i("dyte-icon",{icon:this.iconPack.send}))),this.isEditing&&i("div",{class:"edit-buttons"},i("dyte-tooltip",Object.assign({variant:"secondary",label:this.t("cancel"),delay:2e3},t),i("dyte-button",Object.assign({kind:"icon",variant:"secondary",onClick:()=>this.handleEditCancel(),title:this.t("cancel")},t),i("dyte-icon",{icon:this.iconPack.dismiss}))),i("dyte-tooltip",Object.assign({variant:"primary",label:this.t("chat.update_msg"),delay:2e3},t),i("dyte-button",Object.assign({kind:"icon",onClick:()=>this.handleEditMessage(),title:this.t("chat.send_msg")},t),i("dyte-icon",{icon:this.iconPack.checkmark}))))))))}};D.style=":host {\n  display: flex;\n  flex-direction: column;\n  font-family: var(--dyte-font-family, sans-serif);\n  font-size: 14px;\n  position: relative;\n}\n\n.quoted-message-container {\n  margin-bottom: var(--dyte-space-2, 8px);\n  display: flex;\n  justify-content: space-between;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n  border-radius: var(--dyte-border-radius-md, 8px);\n  border: var(--dyte-border-width-sm, 1px) solid rgb(var(--dyte-colors-background-600, 60 60 60));\n}\n\n.quoted-message-container .quoted-message {\n  flex: 1 1 0%;\n  padding: var(--dyte-space-2, 8px);\n  border-radius: var(--dyte-border-radius-md, 8px);\n  max-height: var(--dyte-space-24, 96px);\n  overflow-y: auto;\n  word-break: break-all;\n}\n\n.quoted-message-container .quoted-message blockquote {\n  display: none;\n}\n\n.quoted-message-container dyte-icon.dismiss {\n  margin-left: auto;\n  height: var(--dyte-space-5, 20px);\n  width: var(--dyte-space-5, 20px);\n  padding: var(--dyte-space-2, 8px);\n  border-radius: var(--dyte-border-radius-md, 8px);\n  color: rgb(var(--dyte-colors-text-600, 255 255 255 / 0.52));\n}\n\n.quoted-message-container dyte-icon.dismiss:hover {\n  cursor: pointer;\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n}\n\n.quoted-message-container dyte-icon.dismiss {\n  transition-property: color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;\n  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;\n  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 150ms;\n}\n\n.composer-container {\n  position: relative;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));\n  border-radius: var(--dyte-border-radius-md, 8px);\n  overflow: hidden;\n  border: var(--dyte-border-width-sm, 1px) solid rgb(var(--dyte-colors-background-600, 60 60 60));\n}\n\n.composer-container > .composers {\n    min-height: 60px;\n  }\n\n@container chatcontainer (height < 360px) {\n    .composer-container > .composers {\n      min-height: 30px;\n    }\n}\n\n.chat-buttons {\n  padding: var(--dyte-space-3, 12px);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  --tw-bg-opacity: 1;\n  background-color: rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));\n  color: rgb(var(--dyte-colors-text-1000, 255 255 255));\n}\n\n.chat-buttons .right {\n  z-index: 10;\n}\n\n.chat-buttons .right .edit-buttons {\n  display: flex;\n  gap: var(--dyte-space-2, 8px);\n}\n\n.chat-buttons > div {\n  display: flex;\n  align-items: center;\n}\n\ndyte-emoji-picker {\n  z-index: 20;\n  position: absolute;\n  top: calc(var(--dyte-space-72, 288px) * -1);\n  border-top: var(--dyte-border-width-sm, 1px) solid rgb(var(--dyte-colors-background-600, 60 60 60));\n  animation: 0.3s slide-up ease;\n}\n\n@keyframes slide-up {\n  from {\n    transform: translateY(100%);\n  }\n  to {\n    transform: translateY(0%);\n  }\n}\n";const $=class{constructor(i){t(this,i),this.onPinMessage=e(this,"pinMessage",7),this.stateUpdate=e(this,"dyteStateUpdate",7),this.observingEl=[],this.autoScrollEnabled=!0,this.onScroll=t=>{const e=t.target;a((()=>{const{scrollTop:t,clientHeight:i,scrollHeight:n}=e;t+i+10>=n?(this.autoScrollEnabled=!0,this.showLatestMessageButton=!1):this.autoScrollEnabled=!1}))},this.scrollToBottom=()=>{m(this.$chat)},this.observeMessage=t=>{t&&this.observingEl.push(t);try{this.intersectionObserver.observe(t)}catch(t){}},this.getMessageActions=t=>{const e=[];return!t.pinned&&this.canPinMessages&&e.push({id:"pin_message",label:this.t("pin"),icon:this.iconPack.pin}),e},this.onMessageActionHandler=(t,e)=>{switch(t){case"pin_message":this.onPinMessage.emit(e)}},this.selectedGroup=void 0,this.messages=[],this.selfUserId=void 0,this.canPinMessages=!1,this.size=void 0,this.iconPack=d,this.t=c(),this.now=new Date,this.showLatestMessageButton=!1}connectedCallback(){var t;this.lastReadTimestamp=null!==(t=h.everyone)&&void 0!==t?t:new Date("0001-01-01T00:00:00Z"),this.intersectionObserver=new IntersectionObserver((t=>{document.hasFocus()&&a((()=>{for(const e of t)e.isIntersecting&&parseInt(e.target.getAttribute("data-timestamp"))>this.lastReadTimestamp.getTime()&&(h[this.selectedGroup]=new Date)}))}));const e=()=>{this.now=new Date,this.timeout=setTimeout((()=>{null!=this.request&&(this.request=requestAnimationFrame(e))}),6e4)};this.request=requestAnimationFrame(e),this.chatChanged(this.messages)}componentDidLoad(){this.$chat.addEventListener("scroll",this.onScroll),this.$chat.scrollTop=this.$chat.scrollHeight}componentDidRender(){this.autoScrollEnabled?m(this.$chat):null==this.autoScrollEnabled&&m(this.$chat,!1)}chatChanged(t){if(null!=this.$chat&&!this.autoScrollEnabled&&this.$chat.clientHeight!==this.$chat.scrollHeight)for(let e=t.length-1;e>=0;e--)if(t[e].message.time>this.lastReadTimestamp&&t[e].message.userId!==this.selfUserId){this.showLatestMessageButton=!0;break}}selectedBucketChanged(){this.autoScrollEnabled=void 0,this.observingEl.forEach((t=>{this.intersectionObserver.unobserve(t)})),this.observingEl=[]}disconnectedCallback(){this.$chat.removeEventListener("scroll",this.onScroll),this.intersectionObserver.disconnect(),clearTimeout(this.timeout),cancelAnimationFrame(this.request)}render(){var t;let e=null,s=!1;return i(n,null,i("div",{class:"chat-container scrollbar",ref:t=>this.$chat=t,part:"container"},i("div",{class:"spacer",part:"spacer"}),i("div",{class:"chat",part:"chat"},null===(t=this.messages)||void 0===t?void 0:t.map((t=>{if("chat"===t.type){const{message:n}=t,a=!(n.userId===this.selfUserId)&&!this.autoScrollEnabled&&!s&&n.time>this.lastReadTimestamp;a&&(s=a);const r=!a&&n.userId===(null==e?void 0:e.userId)&&v(n.time,null==e?void 0:e.time)<2;return e=n,i("div",{"is-continued":r,key:t.message.id,ref:this.observeMessage,"data-timestamp":n.time.getTime(),class:n.pinned?"pinned":""},a&&i("div",{class:"new-chat-marker",part:"new-chat-marker"},this.t("chat.new")),i("div",{class:"message-wrapper"},i("dyte-message-view",{time:n.time,actions:this.getMessageActions(n),authorName:n.displayName,hideAvatar:!0,hideAuthorName:!0,hideMetadata:!0,viewType:"incoming",variant:"plain",onAction:t=>this.onMessageActionHandler(t.detail,n)},i("div",null,!r&&i("div",{class:"head"},i("div",{class:"name"},n.displayName),!!n.time&&i("div",{class:"time",title:y(n.time)},b(n.time,new Date(Date.now())))),i("div",{class:"body"},"text"===n.type&&i("dyte-text-message-view",{text:n.message,isMarkdown:!0}),"file"===n.type&&i("dyte-file-message-view",{name:n.name,url:n.link,size:n.size}),"image"===n.type&&i("dyte-image-message-view",{url:n.link,onPreview:()=>{this.stateUpdate.emit({image:n}),o.image=n}})))),n.pinned&&i("div",{class:"pin-button",part:"pin-button"},i("dyte-tooltip",{label:this.t("unpin"),iconPack:this.iconPack,t:this.t},i("dyte-button",{kind:"icon",variant:"ghost",onClick:()=>this.onMessageActionHandler("pin_message",n),iconPack:this.iconPack,t:this.t,disabled:!this.canPinMessages},i("dyte-icon",{icon:this.iconPack.pin,iconPack:this.iconPack,t:this.t,size:"sm"}))))))}return null})))),i("div",{class:"show-new-messages-ctr"},i("dyte-button",{class:{"show-new-messages":!0,active:this.showLatestMessageButton},kind:"icon",part:"show-new-messages",onClick:this.scrollToBottom,iconPack:this.iconPack,t:this.t},i("dyte-icon",{icon:this.iconPack.chevron_down,iconPack:this.iconPack,t:this.t}))))}static get watchers(){return{messages:["chatChanged"],selectedGroup:["selectedBucketChanged"]}}};$.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}.scrollbar{scrollbar-width:thin;scrollbar-color:var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)))\n    var(--dyte-scrollbar-background, transparent)}.scrollbar::-webkit-scrollbar{height:var(--dyte-space-1\\.5, 6px);width:var(--dyte-space-1\\.5, 6px);border-radius:9999px;background-color:var(--dyte-scrollbar-background, transparent)}.scrollbar::-webkit-scrollbar-thumb{border-radius:9999px;background-color:var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)))}:host{position:relative;display:flex;flex-direction:column;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity));word-break:break-word}.chat-container{box-sizing:border-box;display:flex;flex-direction:column;padding-top:var(--dyte-space-4, 16px);padding-bottom:var(--dyte-space-4, 16px);flex:1 0 0px;overflow-y:scroll}.chat-container .spacer{flex:1 1 auto}.chat-container .chat{flex:0 0 auto}.file-picker{display:none}.chat .head{display:flex;align-items:center}.chat .head .name{margin-right:var(--dyte-space-4, 16px);font-size:12px;font-weight:700}.chat .head .time{font-size:12px;color:rgb(var(--dyte-colors-text-800, 255 255 255 / 0.76))}.chat .body{margin-top:var(--dyte-space-2, 8px);overflow-wrap:break-word;line-height:1.375}.chat .body .emoji{font-size:24px}p{margin-top:var(--dyte-space-0, 0px);margin-bottom:var(--dyte-space-3, 12px)}dyte-message-view{margin-top:var(--dyte-space-4, 16px);display:block;padding-left:var(--dyte-space-2, 8px);padding-right:var(--dyte-space-2, 8px);color:rgb(var(--dyte-colors-text-900, 255 255 255 / 0.88));box-sizing:border-box}dyte-message-view::part(message){flex-grow:1}*[is-continued] dyte-message-view{margin-top:var(--dyte-space-1, 4px)}.pinned .message-wrapper{position:relative}.pinned .pin-button{position:absolute;right:var(--dyte-space-4, 16px);top:calc(var(--dyte-space-4, 16px) * -1);display:flex;border-radius:var(--dyte-border-radius-sm, 4px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-600, 60 60 60) / var(--tw-bg-opacity))}.pinned .pin-button:hover dyte-button{--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-brand-600, 13 81 253) / var(--tw-bg-opacity))}.pinned dyte-message-view{--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-700, 44 44 44) / var(--tw-bg-opacity));padding-top:var(--dyte-space-1, 4px);padding-bottom:var(--dyte-space-1, 4px)}a{--tw-text-opacity:1;color:rgba(var(--dyte-colors-brand-300, 73 124 253) / var(--tw-text-opacity));-webkit-text-decoration-line:none;text-decoration-line:none}a:hover{-webkit-text-decoration-line:underline;text-decoration-line:underline}.new-chat-marker{display:flex;width:100%;align-items:center;gap:var(--dyte-space-2, 8px);--tw-text-opacity:1;color:rgba(var(--dyte-colors-brand-300, 73 124 253) / var(--tw-text-opacity))}.new-chat-marker::before{content:'';height:1px;flex:1 1 0%;background-color:rgba(var(--dyte-colors-brand-300, 73 124 253) / 0.5)}.show-new-messages-ctr{pointer-events:none;display:flex;justify-content:flex-end;padding:var(--dyte-space-3, 12px);z-index:0;margin-top:calc(var(--dyte-space-14, 56px) * -1)}.show-new-messages{pointer-events:auto;--tw-translate-y:var(--dyte-space-16, 64px);transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));opacity:0;transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.show-new-messages.active{--tw-translate-y:var(--dyte-space-0, 0px);transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));opacity:1}";const P=class{constructor(n){t(this,n),this.editMessageInit=e(this,"editMessageInit",7),this.pageSize=25,this.lastReadMessageIndex=-1,this.hasChildren=(t,e)=>{if(!this.children)return null;const n=this.children.cloneNode(!0);return n.message=t,n.isContinued=e,i("div",{ref:t=>t.appendChild(n)})},this.maybeMarkChannelAsRead=t=>{if(!this.selectedChannelId)return;if(0===t.length)return;if(-1!==this.lastReadMessageIndex)return;const e=t.at(0).time>t.at(-1).time?t.at(0):t.at(-1);e.channelIndex&&(this.lastReadMessageIndex=parseInt(e.channelIndex,10),this.meeting.chat.markLastReadMessage(this.selectedChannelId,e))},this.getChatMessages=async(t,e,i)=>{const{messages:n}=await this.meeting.chat.getMessages(t,e,i,void 0,this.selectedChannelId);return this.maybeMarkChannelAsRead(n),n},this.createChatNodes=t=>t.map(((e,i)=>{var n;const s=e.userId===(null===(n=t[i-1])||void 0===n?void 0:n.userId);return this.createChatNode(e,s)})),this.disconnectMeeting=t=>{var e;null===(e=null==t?void 0:t.chat)||void 0===e||e.removeListener("chatUpdate",this.chatUpdateListener)},this.createChatNode=(t,e)=>{var n,s,a;const o=this.meeting.self.userId===t.userId,r=null===(n=this.meeting.self.permissions)||void 0===n?void 0:n.chatMessage,d=void 0===r?o:"ALL"===r.canEdit||"SELF"===r.canEdit&&o,c=void 0===r?o:"ALL"===r.canDelete||"SELF"===r.canDelete&&o;return i("dyte-chat-message",{leftAlign:this.leftAlign,message:t,isContinued:e,isUnread:!1,size:this.size,iconPack:this.iconPack,key:t.id,isSelf:o,alignRight:o&&"CHAT"===this.meeting.meta.viewType,disableControls:"CHAT"!==this.meeting.meta.viewType,senderDisplayPicture:null===(s=this.meeting.participants.all.toArray().find((e=>e.userId===t.userId)))||void 0===s?void 0:s.picture,hideAvatar:o&&"CHAT"===this.meeting.meta.viewType||(null===(a=this.selectedChannel)||void 0===a?void 0:a.isDirectMessage),canEdit:d&&"text"===t.type,canDelete:c,canReply:"text"===t.type,onEdit:()=>{"text"===t.type&&this.editMessageInit.emit({payload:t,flags:{isEdit:!0}})},onReply:()=>{"text"===t.type&&this.editMessageInit.emit({payload:t,flags:{isReply:!0}})},onDelete:async()=>{var e;await this.meeting.chat.deleteMessage(t.id,null===(e=this.selectedChannel)||void 0===e?void 0:e.id).catch((()=>{}))}},this.hasChildren(t,e))},this.chatUpdateListener=t=>{this.selectedChannelId&&t.message.channelId!==this.selectedChannelId||("add"===t.action?(this.$paginatedListRef.onNewNode(t.message),this.lastReadMessageIndex=-1,this.maybeMarkChannelAsRead([t.message])):"delete"===t.action?this.$paginatedListRef.onNodeDelete(t.message.id):"edit"===t.action&&this.$paginatedListRef.onNodeUpdate(t.message.id,t.message))},this.meeting=void 0,this.selectedChannel=void 0,this.selectedChannelId=void 0,this.size=void 0,this.iconPack=d,this.t=c(),this.children=void 0,this.leftAlign=!1}componentDidLoad(){const t=this.host.shadowRoot.querySelector("slot");t&&(this.children=t.assignedElements()[0])}connectedCallback(){this.meetingChanged(this.meeting)}disconnectedCallback(){this.disconnectMeeting(this.meeting)}meetingChanged(t,e){var i;null!=e&&this.disconnectMeeting(e),t&&!t.chat||null!=t&&(null===(i=t.chat)||void 0===i||i.addListener("chatUpdate",this.chatUpdateListener))}channelChanged(){this.lastReadMessageIndex=-1}render(){return i(n,null,i("dyte-paginated-list",{ref:t=>this.$paginatedListRef=t,pageSize:this.pageSize,pagesAllowed:3,fetchData:this.getChatMessages,createNodes:this.createChatNodes,selectedItemId:this.selectedChannelId,emptyListLabel:this.t("chat.empty_channel")},i("slot",null)))}get host(){return s(this)}static get watchers(){return{meeting:["meetingChanged"],selectedChannelId:["channelChanged"]}}};P.style=":host{display:flex;flex-direction:column;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity));flex:1 0 0px}";const R=class{constructor(e){t(this,e),this.pageSize=50,this.searchMessages=async(t,e,i)=>this.meeting.chat.searchMessages(this.query,{channelId:this.channelId,timestamp:t,size:e,reversed:i}),this.nodeRenderer=t=>t.map((t=>i("dyte-chat-message",{key:t.id,message:t,disableControls:!0}))),this.meeting=void 0,this.query=void 0,this.channelId=void 0,this.iconPack=d,this.t=c()}render(){return i(n,null,i("dyte-paginated-list",{pageSize:this.pageSize,pagesAllowed:3,fetchData:this.searchMessages,createNodes:this.nodeRenderer,selectedItemId:this.query}))}};R.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{display:flex;height:100%;flex-direction:column;position:relative;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-900, 26 26 26) / var(--tw-bg-opacity))}";const z=class{constructor(i){t(this,i),this.stateUpdate=e(this,"dyteStateUpdate",7),this.updateStoreState=(t,e)=>{o[t]=e,this.stateUpdate.emit({[t]:e})},this.cancelJoinStage=async()=>{var t,e,i;"ACCEPTED_TO_JOIN_STAGE"===(null===(t=this.meeting.stage)||void 0===t?void 0:t.status)&&await(null===(i=null===(e=this.meeting)||void 0===e?void 0:e.stage)||void 0===i?void 0:i.leave()),this.updateStoreState("activeJoinStage",!1)},this.joinStage=async()=>{await this.meeting.stage.join()},this.stageStatusUpdateListener=t=>{var e;((null===(e=this.states)||void 0===e?void 0:e.activeJoinStage)||o.activeJoinStage)&&"ON_STAGE"===t&&this.updateStoreState("activeJoinStage",!1)},this.meeting=void 0,this.config=f,this.states=o,this.size=void 0,this.iconPack=d,this.t=c()}connectedCallback(){this.meetingChanged(this.meeting)}disconnectedCallback(){var t;null===(t=this.meeting.stage)||void 0===t||t.removeListener("stageStatusUpdate",this.stageStatusUpdateListener)}meetingChanged(t){if(null==t)return;const{stage:e}=t;null==e||e.addListener("stageStatusUpdate",this.stageStatusUpdateListener)}render(){var t,e,s,a;const r={meeting:this.meeting,states:this.states||o,config:this.config,size:this.size,iconPack:this.iconPack,t:this.t},d=this.states||o;if(null!=(null==d?void 0:d.image)){const t=()=>{this.stateUpdate.emit({image:null}),o.image=null};return i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:t,hideCloseButton:!0,iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-image-viewer",defaults:r,props:{image:d.image,onClose:t}})))}if(!0===(null==d?void 0:d.activeSettings))return i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeSettings",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-settings",defaults:r})));if(!0===(null==d?void 0:d.activeDebugger))return i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeDebugger",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-debugger",defaults:r})));if(!0===(null==d?void 0:d.activeLeaveConfirmation))return i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeLeaveConfirmation",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-leave-meeting",defaults:r})));if(!0===(null===(t=null==d?void 0:d.activePermissionsMessage)||void 0===t?void 0:t.enabled))return i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activePermissionsMessage",{enabled:!1}),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-permissions-message",defaults:r})));if(!0===(null==d?void 0:d.activeRemoteAccessManager))return i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeRemoteAccessManager",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-remote-access-manager",defaults:r})));if(!0===(null===(e=null==d?void 0:d.activeBreakoutRoomsManager)||void 0===e?void 0:e.active))return i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeBreakoutRoomsManager",{active:!1,data:void 0}),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-breakout-rooms-manager",defaults:r,props:{mode:this.meeting.connectedMeetings.isActive?"view":"create"}})));if(!0===(null===(s=null==d?void 0:d.activeConfirmationModal)||void 0===s?void 0:s.active))return i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeConfirmationModal",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-confirmation-modal",defaults:r})));if(!0===(null===(a=null==d?void 0:d.activeOverlayModal)||void 0===a?void 0:a.active))return i(n,null,i("dyte-overlay-modal",{meeting:this.meeting,states:this.states,iconPack:this.iconPack,t:this.t}));if(null==d?void 0:d.activeBroadcastMessageModal)return i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>this.updateStoreState("activeBroadcastMessageModal",!1),iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-broadcast-message-modal",defaults:r})));if(!0===(null==d?void 0:d.activeJoinStage)){const t={title:this.t("stage.join_title"),label:{accept:this.t("stage.join_confirm"),reject:this.t("stage.join_cancel")},description:this.t("stage.join_summary")};return i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:this.cancelJoinStage,iconPack:this.iconPack,t:this.t},i("dyte-join-stage",Object.assign({dataConfig:t,onDyteJoinStage:this.joinStage,onDyteLeaveStage:this.cancelJoinStage},r))))}return!0===(null==d?void 0:d.activeMuteAllConfirmation)?i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>{this.updateStoreState("activeMuteAllConfirmation",!1)},iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-mute-all-confirmation",defaults:r}))):(null==d?void 0:d.activeChannelCreator)?i(n,null,i("dyte-dialog",{open:!0,onDyteDialogClose:()=>{this.updateStoreState("activeChannelCreator",!1)},iconPack:this.iconPack,t:this.t},i(x,{element:"dyte-channel-creator",defaults:r}))):null}static get watchers(){return{meeting:["meetingChanged"]}}};z.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{display:block}";const q=Object.freeze({notifications:{participant_joined:!0,participant_left:!0,participant_joined_waitlist:!0,chat:!0,polls:!0,webinar:!0,tab_sync:!0,recording_started:!0,recording_stopped:!0},notification_sounds:{participant_joined:!0,participant_left:!0,chat:!0,polls:!0,webinar:!0,participant_joined_waitlist:!0},notification_duration:{participant_joined:2100,participant_left:2100,participant_joined_waitlist:4e3,chat:2e3,polls:2e3,webinar:2e3,tab_sync:2e3,recording_started:2e3,recording_stopped:2e3},participant_joined_sound_notification_limit:10,participant_chat_message_sound_notification_limit:10});function A(t){return Object.keys(t).filter((e=>t[e]))}const T=class{constructor(e){t(this,e),this.permissions=q,this.enabledSounds=A(q.notification_sounds),this.addStagePeersListeners=t=>{t.participants.joined.addListener("participantJoined",this.participantJoinedListener),t.meta.addListener("disconnected",this.networkDisconnectedListener),t.meta.addListener("connected",this.networkConnectedListener),t.participants.joined.addListener("participantLeft",this.participantLeftListener)},this.removeStagePeersListeners=t=>{t.participants.joined.removeListener("participantJoined",this.participantJoinedListener),t.meta.removeListener("disconnected",this.networkDisconnectedListener),t.meta.removeListener("connected",this.networkConnectedListener),t.participants.joined.removeListener("participantLeft",this.participantLeftListener)},this.onRemoteUpdate=({payload:t,type:e})=>{if(e===w.INCOMING_REQUEST_ACCEPTED){let e=this.meeting.participants.joined.get(t.request.remotePeerId);this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:`Granted remote control to ${e.name}`,duration:2e3})}if(e===w.OUTGOING_REQUEST_ACCEPTED){let e=this.meeting.participants.joined.get(t.request.hostPeerId);this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:`${e.name} has granted remote control.`,duration:2e3})}if(e===w.REQUEST_RECEIVED){let e=this.meeting.participants.joined.get(t.request.remotePeerId);this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:`${e.name} has requested for remote control.`,duration:2e3})}if(e!==w.INCOMING_REQUEST_ENDED&&e!==w.OUTGOING_REQUEST_ENDED||this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:"Existing remote control has been terminated.",duration:2e3}),e===w.REQUEST_SENT){let e=this.meeting.participants.joined.get(t.request.hostPeerId);this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:`Sent remote control request to ${e.name}`,duration:2e3})}},this.onDyteNotification=t=>{this.add(t.detail);const e=t.detail.playSound;null!=e&&this.audio.play(e)},this.onRecordingUpdate=t=>{var e,i;"RECORDING"===t&&!1!==this.permissions.notifications.recording_started?this.add({id:"recording-started",icon:this.iconPack.recording,message:this.t("recording.started"),duration:null!==(e=this.permissions.notification_duration.recording_started)&&void 0!==e?e:2e3}):"STOPPING"===t&&!1!==this.permissions.notifications.recording_stopped&&this.add({id:"recording-stopped",icon:this.iconPack.stop_recording,message:this.t("recording.stopped"),duration:null!==(i=this.permissions.notification_duration.recording_stopped)&&void 0!==i?i:2e3})},this.meeting=void 0,this.states=void 0,this.config=f,this.t=c(),this.size=void 0,this.iconPack=d,this.notifications=[]}connectedCallback(){"undefined"!=typeof document&&(null===document||void 0===document||document.addEventListener("dyteNotification",this.onDyteNotification)),this.meetingChanged(this.meeting),this.configChanged(this.config),this.statesChanged(this.states)}clearListeners(t){var e,i,n,s,a,o,r,d,c;const l="LIVESTREAM"===t.meta.viewType;(l&&"ON_STAGE"===(null===(e=t.stage)||void 0===e?void 0:e.status)||!l)&&this.removeStagePeersListeners(t),this.chatUpdateListener&&(null===(i=t.chat)||void 0===i||i.removeListener("chatUpdate",this.chatUpdateListener)),this.pollUpdateListener&&(null===(n=t.polls)||void 0===n||n.removeListener("pollsUpdate",this.pollUpdateListener)),this.socketDisconnectedListener&&t.meta.removeListener("socketDisconnected",this.socketDisconnectedListener),this.socketReconnectFailureListener&&t.meta.removeListener("socketReconnectFailure",this.socketReconnectFailureListener),this.socketReconnectedListener&&t.meta.removeListener("socketReconnected",this.socketReconnectedListener),this.socketReconnectingListener&&t.meta.removeListener("socketReconnecting",this.socketReconnectingListener),this.socketFailureListener&&t.meta.removeListener("socketFailure",this.socketFailureListener),this.stageRequestAccepted&&(null===(s=t.stage)||void 0===s||s.removeListener("stageRequestApproved",this.stageRequestAccepted)),this.stageRequestRejected&&(null===(a=t.stage)||void 0===a||a.removeListener("stageRequestRejected",this.stageRequestRejected)),this.newStageRequests&&(null===(o=t.stage)||void 0===o||o.removeListener("newStageRequest",this.newStageRequests)),this.stageStatusUpdateListener&&(null===(r=t.stage)||void 0===r||r.removeListener("stageStatusUpdate",this.stageStatusUpdateListener)),null===(d=t.remote)||void 0===d||d.removeListener("remoteUpdate",this.onRemoteUpdate),null===(c=t.recording)||void 0===c||c.removeListener("recordingUpdate",this.onRecordingUpdate),clearTimeout(this.disconnectTimeout),t.self.removeListener("deviceUpdate",this.deviceUpdateListener)}disconnectedCallback(){var t;"undefined"!=typeof document&&(null===document||void 0===document||document.removeEventListener("dyteNotification",this.onDyteNotification)),null!=this.meeting&&(this.clearListeners(this.meeting),this.waitlistedParticipantJoinedListener&&this.meeting.participants.waitlisted.removeListener("participantJoined",this.waitlistedParticipantJoinedListener),this.activeTabUpdateListener&&(null===(t=this.meeting.meta)||void 0===t||t.removeListener("activeTabUpdate",this.activeTabUpdateListener)),this.peerStageStatusListener&&this.meeting.participants.joined.removeListener("stageStatusUpdate",this.peerStageStatusListener))}meetingChanged(t,e){var i,n,s,a,o,d,c,l,h;if(clearTimeout(this.disconnectTimeout),void 0!==e&&this.clearListeners(e),null==t)return;const p="LIVESTREAM"===t.meta.viewType;this.audio=new k(t);const{notifications:g,notification_duration:v,notification_sounds:y}=this.permissions;if(this.participantJoinedListener=t=>{g.participant_joined&&this.add({id:`${t.id}-joined`,message:`${C(t.name)} just joined`,image:t.picture,duration:v.participant_joined}),y.participant_joined&&this.canPlayParticipantJoinedSound()&&this.audio.play("joined")},this.participantLeftListener=t=>{g.participant_left&&this.add({id:`${t.id}-left`,message:`${C(t.name)} left`,image:t.picture,duration:v.participant_left}),y.participant_left&&this.canPlayParticipantJoinedSound()&&this.audio.play("left")},this.waitlistedParticipantJoinedListener=t=>{const e=`${t.id}-joined-waitlist`;this.add({id:e,message:`${C(t.name)} is requesting to join the meeting`,image:t.picture,duration:v.participant_joined_waitlist,button:{text:"Accept",variant:"secondary",onClick:async()=>{await this.meeting.participants.acceptWaitingRoomRequest(t.id),this.remove(e)}}}),y.participant_joined_waitlist&&this.canPlayParticipantJoinedSound()&&this.audio.play("message")},this.chatUpdateListener=({message:e})=>{const i=u(e);if(null!=i){if(i.userId===t.self.userId)return;"text"===i.type&&(g.chat&&this.add({id:`message-${Math.random().toString(36)}`,icon:this.iconPack.chat,message:`${i.displayName}: ${i.message}`,duration:v.chat}),y.chat&&this.canPlayChatSound()&&this.audio.play("message"))}},this.pollUpdateListener=({polls:t,newPoll:e})=>{!1!==e&&(g.polls&&this.meeting.self.userId!==t[t.length-1].createdByUserId&&this.add({id:`poll-${Math.random().toString(36)}`,icon:this.iconPack.poll,message:`New poll created by ${t[t.length-1].createdBy}`,duration:v.polls}),y.polls&&this.meeting.self.userId!==t[t.length-1].createdByUserId&&this.canPlayChatSound()&&this.audio.play("message"))},this.deviceUpdateListener=({device:t,preview:e})=>{e||("audiooutput"===t.kind?(this.audio.setDevice(t.deviceId),this.add({id:`speaker-switched-${t.deviceId}`,message:`Connected to ${t.label}`,icon:this.iconPack.speaker,duration:5e3})):this.add("videoinput"===t.kind?{id:`camera-switched-${t.deviceId}`,message:`Connected to ${t.label}`,icon:this.iconPack.speaker,duration:5e3}:{id:`mic-switched-${t.deviceId}`,message:`Connected to ${t.label}`,icon:this.iconPack.mic_on,duration:5e3}))},this.networkDisconnectedListener=()=>{let t;this.remove("network"),t=2e4,this.add({id:"network",icon:this.iconPack.disconnected,message:this.t("network.reconnecting"),duration:2e4}),this.disconnectTimeout=setTimeout((()=>{this.add({id:"network-lost",icon:this.iconPack.disconnected,message:this.t("network.delay"),button:{text:this.t("end"),variant:"danger",onClick:()=>{var t;return null===(t=this.meeting)||void 0===t?void 0:t.leaveRoom()}}})}),2e4)},this.networkConnectedListener=()=>{let t;this.remove("network"),this.remove("network-lost"),t=3e3,this.add({id:"network",icon:this.iconPack.wifi,message:this.t("network.restored"),duration:3e3}),clearTimeout(this.disconnectTimeout)},this.socketUpdateListener=({event:t,attempt:e})=>{this.remove("socket"),"reconnected"===t?(this.remove("socketReconnecting"),this.add({id:"socket",icon:this.iconPack.wifi,message:this.t("network.restored"),duration:3e3})):"disconnected"===t?this.add({id:"socket",icon:this.iconPack.disconnected,message:this.t("network.lost"),duration:3e3}):"reconnecting"===t?this.add({id:"socketReconnecting",icon:this.iconPack.disconnected,message:this.t("network.lost_extended")}):"reconnectFailure"===t?e>5&&(this.remove("socketReconnecting"),this.add({id:"socketReconnecting",icon:this.iconPack.disconnected,message:this.t("network.delay_extended"),button:{text:this.t("end"),variant:"danger",onClick:()=>{var t;return null===(t=this.meeting)||void 0===t?void 0:t.leaveRoom()}}})):"failed"===t&&(this.remove("socketReconnecting"),this.add({id:"socketFailed",icon:this.iconPack.disconnected,message:this.t("network.disconnected")}),this.add({id:"leaveMeeting",icon:this.iconPack.warning,message:this.t("network.leaving")}),setTimeout((()=>{var t;null===(t=this.meeting)||void 0===t||t.leaveRoom("disconnected")}),1e4))},this.activeTabUpdateListener=e=>{if(g.tab_sync)switch(e.type){case"plugin":const i=t.plugins.active.toArray().find((t=>t.id==e.id));null!=i&&this.add({id:"activeTab",message:`Plugin switched to ${i.name}`,duration:v.participant_joined});break;case"screenshare":const n=t.participants.joined.toArray().filter((t=>t.screenShareEnabled)).find((t=>t.id==e.id));null!=n&&this.add({id:"spotlight",message:`Now watching ${n.name}'s screen`,duration:v.webinar})}},this.peerStageStatusListener=t=>{"REQUESTED_TO_JOIN_STAGE"===t.stageStatus&&(this.add({id:`stage-request-${t.id}`,message:`${t.name} has requested to join stage`,duration:v.webinar,button:{text:"Accept",variant:"primary",onClick:async()=>{await this.meeting.stage.grantAccess([t.userId]),this.remove(`stage-request-${t.id}`)}}}),y.webinar&&this.audio.play("joined")),"ON_STAGE"===t.stageStatus&&(this.add({id:`stage-joined-${t.id}`,message:`${t.name} has joined stage`,duration:v.webinar}),y.webinar&&this.audio.play("joined"))},this.stageRequestAccepted=()=>{this.add({id:"stage-request-accepted",message:"Request to join accepted",duration:3e3})},this.stageRequestRejected=()=>{this.add({id:"stage-request-rejected",message:"Request to join rejected",duration:3e3})},this.newStageRequests=({count:t})=>{this.add({id:"new-stage-request",message:`You have ${t<0?"new stage":`${t} pending`} request${1===t?"":"s"}`,duration:3e3})},this.stageStatusUpdateListener=e=>{"ON_STAGE"===e?this.addStagePeersListeners(t):this.removeStagePeersListeners(t)},this.socketReconnectedListener=()=>this.socketUpdateListener({event:"reconnected"}),this.socketDisconnectedListener=()=>this.socketUpdateListener({event:"disconnected"}),this.socketReconnectingListener=()=>this.socketUpdateListener({event:"reconnecting"}),this.socketFailureListener=()=>this.socketUpdateListener({event:"failed"}),this.socketReconnectFailureListener=({attempt:t})=>this.socketUpdateListener({event:"reconnectFailure",attempt:t}),!r(t)&&(null===(i=t.chat)||void 0===i||i.addListener("chatUpdate",this.chatUpdateListener)),"CHAT"===t.self.config.viewType)return;const b=t.self.getCurrentDevices();null!=b.speaker&&this.audio.setDevice(b.speaker.deviceId),p?null===(n=t.stage)||void 0===n||n.on("stageStatusUpdate",this.stageStatusUpdateListener):this.addStagePeersListeners(t),this.canAcceptWaitingRequests()&&t.participants.waitlisted.addListener("participantJoined",this.waitlistedParticipantJoinedListener),null===(s=t.polls)||void 0===s||s.addListener("pollsUpdate",this.pollUpdateListener),t.self.addListener("deviceUpdate",this.deviceUpdateListener),t.meta.addListener("socketReconnected",this.socketReconnectedListener),t.meta.addListener("socketDisconnected",this.socketDisconnectedListener),t.meta.addListener("socketReconnecting",this.socketReconnectingListener),t.meta.addListener("socketFailure",this.socketFailureListener),t.meta.addListener("socketReconnectFailure",this.socketReconnectFailureListener),null===(a=t.remote)||void 0===a||a.addListener("remoteUpdate",this.onRemoteUpdate),null===(o=t.meta)||void 0===o||o.addListener("activeTabUpdate",this.activeTabUpdateListener),null===(d=t.recording)||void 0===d||d.addListener("recordingUpdate",this.onRecordingUpdate),null===(c=t.stage)||void 0===c||c.addListener("stageRequestApproved",this.stageRequestAccepted),null===(l=t.stage)||void 0===l||l.addListener("stageRequestRejected",this.stageRequestRejected),t.self.permissions.stageEnabled&&t.self.permissions.acceptStageRequests&&(null===(h=t.stage)||void 0===h||h.addListener("newStageRequest",this.newStageRequests))}configChanged(t){null!=t&&null!=(null==t?void 0:t.config)&&(this.permissions=function(t){const e=Object.assign({},q);return null==t||(Object.assign(e.notification_sounds,t.notification_sounds),Object.assign(e.notifications,t.notifications),Object.assign(e.notification_duration,t.notification_duration),e.participant_chat_message_sound_notification_limit=t.participant_chat_message_sound_notification_limit,e.participant_joined_sound_notification_limit=t.participant_joined_sound_notification_limit),e}(t.config),this.enabledSounds=A(this.permissions.notification_sounds))}statesChanged(t){var e;if(null!=t){const i=!(null===(e=null==t?void 0:t.prefs)||void 0===e?void 0:e.muteNotificationSounds);for(const t of this.enabledSounds)t in this.permissions.notification_sounds&&(this.permissions.notification_sounds[t]=i)}}apiErrorListener({detail:t}){const{trace:e,message:i}=t;this.add({id:e,message:i,duration:2e3,icon:this.iconPack.warning})}sendNotificationListener({detail:t}){const{trace:e,message:i}=t;this.add({id:e,message:i,duration:2e3})}add(t){"visible"===document.visibilityState&&this.notifications.length<5&&(this.notifications=[...this.notifications,t])}remove(t){this.notifications=this.notifications.filter((e=>e.id!==t))}handleDismiss(t){t.stopPropagation();const e=t.detail,i=this.host.shadowRoot.querySelector(`[data-id="${e}"]`);null==i||i.classList.add("exit"),setTimeout((()=>{a((()=>{this.remove(e)}))}),400)}canPlayParticipantJoinedSound(){return null==this.permissions.participant_joined_sound_notification_limit||this.permissions.participant_joined_sound_notification_limit<=0||this.meeting.participants.count<=this.permissions.participant_joined_sound_notification_limit}canPlayChatSound(){return null==this.permissions.participant_chat_message_sound_notification_limit||this.permissions.participant_chat_message_sound_notification_limit<=0||this.meeting.participants.count<=this.permissions.participant_chat_message_sound_notification_limit}canAcceptWaitingRequests(){return this.permissions.notifications.participant_joined_waitlist&&this.meeting.self.permissions.acceptWaitingRequests}render(){return i(n,null,this.notifications.map((t=>i("dyte-notification",{size:this.size,key:t.id,"data-id":t.id,notification:t,onDyteNotificationDismiss:t=>this.handleDismiss(t),iconPack:this.iconPack,t:this.t}))))}get host(){return s(this)}static get watchers(){return{meeting:["meetingChanged"],config:["configChanged"],states:["statesChanged"]}}};T.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{position:absolute;top:var(--dyte-space-4, 16px);right:var(--dyte-space-4, 16px);bottom:var(--dyte-space-4, 16px);left:var(--dyte-space-4, 16px);top:auto;display:flex;flex-direction:column;pointer-events:none;z-index:100}dyte-notification{margin-top:var(--dyte-space-2, 8px)}";export{j as dyte_channel_header,_ as dyte_channel_selector_view,D as dyte_chat_composer_view,$ as dyte_chat_messages_ui,P as dyte_chat_messages_ui_paginated,R as dyte_chat_search_results,z as dyte_dialog_manager,T as dyte_notifications}